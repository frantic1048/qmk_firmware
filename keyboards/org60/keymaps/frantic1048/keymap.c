#include "org60.h"
#include "action_layer.h"


// Helpers
#define ____ KC_NO
#define ___T KC_TRNS
#define GUI_MODS (MOD_BIT(KC_LGUI)|MOD_BIT(KC_RGUI))

enum keyboard_layers {
    _L0,
    _L1,
    _L2,
    _L3,
};
enum keyboard_actions {
    _BSPC,
};

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [_L0] = KEYMAP(
      //--------------------------------------------------------------------------------------------------------------------------------------.
      //        |        |        |        |        |        |        |        |        |        |        |        |        |                 |
      //        |        |        |        |        |        |        |        |        |        |        |        |        |                 |
        KC_GRV , KC_1,    KC_2,    KC_3,    KC_4,    KC_5,    KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    KC_MINS, KC_EQL,  KC_BSPC,     ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //            |        |        |        |        |        |        |        |        |        |        |        |        |             |
      //            |        |        |        |        |        |        |        |        |        |        |        |        |             |
        KC_TAB,      KC_Q,    KC_W,    KC_F,    KC_P,    KC_G,    KC_J,    KC_L,    KC_U,    KC_Y,    KC_SCLN, KC_LBRC, KC_RBRC,       KC_BSLS,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //               |        |        |        |        |        |        |        |        |        |        |        |                   |
      //               |        |        |        |        |        |        |        |        |        |        |        |                   |
        F(_BSPC),       KC_A,    KC_R,    KC_S,    KC_T,    KC_D,    KC_H,    KC_N,    KC_E,    KC_I,    KC_O,    KC_QUOT,  ____,       KC_ENT,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //                   |        |        |        |        |        |        |        |        |        |        |                        |
      //                   |        |        |        |        |        |        |        |        |        |        |                        |
        KC_LSFT,  ____,     KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,    KC_K,    KC_M,    KC_COMM, KC_DOT,  KC_SLSH,  ____,  KC_RSFT,    ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //          |          |          |                                                        |          |           |          |          |
      //          |          |          |                                                        |          |           |          |          |
        KC_LCTL,   KC_LGUI,   KC_LALT,   KC_SPC,                                                  MO(_L1),     MO(_L2),____,MO(_L3),KC_RCTL  ),
      //--------------------------------------------------------------------------------------------------------------------------------------'

    [_L1] = KEYMAP(
      //--------------------------------------------------------------------------------------------------------------------------------------.
      //        |        |        |        |        |        |        |        |        |        |        |        |        |                 |
      //        |        |        |        |        |        |        |        |        |        |        |        |        |                 |
        ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    KC_VOLD, KC_VOLU, KC_MUTE,     ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //            |        |        |        |        |        |        |        |        |        |        |        |        |             |
      //            |        |        |        |        |        |        |        |        |        |        |        |        |             |
        ____,        KC_WH_U, KC_MS_U, KC_WH_D, ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,             ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //               |        |        |        |        |        |        |        |        |        |        |        |                   |
      //               |        |        |        |        |        |        |        |        |        |        |        |                   |
        ____,           KC_MS_L, KC_MS_D, KC_MS_R, ____,    ____,    ____,    ____,    ____,    KC_BTN1, KC_BTN3, KC_BTN2, ____,          ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //                   |        |        |        |        |        |        |        |        |        |        |                        |
      //                   |        |        |        |        |        |        |        |        |        |        |                        |
        ___T,  ____,        ____,    ____,    ____,    ____,    ____,    ____,    ____,    KC_MPRV, KC_MNXT, ____,    ____,   ____,       ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //          |          |          |                                                        |          |           |          |          |
      //          |          |          |                                                        |          |           |          |          |
         ___T,      ___T,     ___T,      KC_MPLY,                                                 MO(_L1),   ____, ____,  ____,      ___T    ),
      //--------------------------------------------------------------------------------------------------------------------------------------'

    [_L2] = KEYMAP(
      //--------------------------------------------------------------------------------------------------------------------------------------.
      //        |        |        |        |        |        |        |        |        |        |        |        |        |                 |
      //        |        |        |        |        |        |        |        |        |        |        |        |        |                 |
        KC_CAPS, KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,   KC_F6,   KC_F7,   KC_F8,   KC_F9,   KC_F10,  KC_F11,  KC_F12,  KC_DEL,      ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //            |        |        |        |        |        |        |        |        |        |        |        |        |             |
      //            |        |        |        |        |        |        |        |        |        |        |        |        |             |
        ____,        ____,    KC_UP,   ____,    ____,    ____,    ____,    ____,    ____,    ____,    KC_PSCR, KC_SLCK, KC_PAUS,        KC_INS,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //               |        |        |        |        |        |        |        |        |        |        |        |                   |
      //               |        |        |        |        |        |        |        |        |        |        |        |                   |
        KC_ESC,         KC_LEFT, KC_DOWN, KC_RIGHT,____,    ____,    ____,    ____,    ____,    ____,    KC_HOME, KC_PGUP, ____,          ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //                   |        |        |        |        |        |        |        |        |        |        |                        |
      //                   |        |        |        |        |        |        |        |        |        |        |                        |
        ___T,  ____,        ____,    KC_APP,  ____,    ____,    ____,    ____,    ____,    ____,    KC_END,  KC_PGDN, ____,   ____,       ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //          |          |          |                                                        |          |           |          |          |
      //          |          |          |                                                        |          |           |          |          |
         ___T,      ___T,     ___T,      ____,                                                    ____,      MO(_L2),____, ____,     ___T    ),
      //--------------------------------------------------------------------------------------------------------------------------------------'

    [_L3] = KEYMAP(
      //--------------------------------------------------------------------------------------------------------------------------------------.
      //        |        |        |        |        |        |        |        |        |        |        |        |        |                 |
      //        |        |        |        |        |        |        |        |        |        |        |        |        |                 |
        ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,        ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //            |        |        |        |        |        |        |        |        |        |        |        |        |             |
      //            |        |        |        |        |        |        |        |        |        |        |        |        |             |
        ____,        ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,             ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //               |        |        |        |        |        |        |        |        |        |        |        |                   |
      //               |        |        |        |        |        |        |        |        |        |        |        |                   |
        ____,           ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,          ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //                   |        |        |        |        |        |        |        |        |        |        |                        |
      //                   |        |        |        |        |        |        |        |        |        |        |                        |
        ____,  ____,        ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,    ____,   ____,       ____,
      //--------------------------------------------------------------------------------------------------------------------------------------|
      //          |          |          |                                                        |          |           |          |          |
      //          |          |          |                                                        |          |           |          |          |
         ____,      ____,     ____,      ____,                                                    TG(_L1),   TG(_L2),____,MO(_L3),  TO(_L0)  ),
      //--------------------------------------------------------------------------------------------------------------------------------------'
};

const uint16_t PROGMEM fn_actions[] = {
    [_BSPC] = ACTION_FUNCTION(_BSPC),
};

void action_function(keyrecord_t *record, uint8_t id, uint8_t opt) {
    static uint8_t is_gui_pressed;

    switch (id) {
        case _BSPC:
            // tricky BSPC c⌒っ.ω.)っ
            is_gui_pressed = get_mods() & GUI_MODS;
            if (record->event.pressed) {
                // key is being pressed
                if (is_gui_pressed) {
                    add_key(KC_ESC);
                    send_keyboard_report();
                } else {
                    add_key(KC_BSPC);
                    send_keyboard_report();
                }
            } else {
                // key is being released
                if (is_gui_pressed) {
                    del_key(KC_ESC);
                    send_keyboard_report();
                } else {
                    del_key(KC_BSPC);
                    send_keyboard_report();
                }
            }
        break;
    }
}

#undef GUI_MODS
#undef ___T
#undef ____
